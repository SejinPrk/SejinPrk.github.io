---
layout: post
title: "[SQL] SQL ì‚½ì… ê³µê²©(SQL Injection Attack) ì°¨ë‹¨/ë°©ì§€"
excerpt: "MySQL ìŠ¤í„°ë””"
categories:
  - Blog
tags:
  - [MySQL, SQL]
toc: true
toc_sticky: true
date: 2024-07-04
last_modified_at: 2024-07-04
---

# [SQL ì‚½ì… ê³µê²© ì°¨ë‹¨/ë°©ì§€]

## SQL ì‚½ì… ê³µê²©(SQL Injection Attack)ì´ë€?

: ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ê°€ì¥ í”í•œ ë³´ì•ˆ ì·¨ì•½ì  ì¤‘ í•˜ë‚˜ë¡œ, ì´ ê³µê²©ì€ ì‚¬ìš©ì ì…ë ¥ì„ í†µí•´ SQL ì¿¼ë¦¬ì— ì•…ì˜ì ì¸ ì½”ë“œë¥¼ ì‚½ì…í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë¹„ì •ìƒì ìœ¼ë¡œ ì¡°ì‘í•˜ê±°ë‚˜ ë¯¼ê°í•œ ì •ë³´ë¥¼ ë…¸ì¶œì‹œí‚¤ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•œë‹¤. 
SQL ì‚½ì… ê³µê²©ì€ ë°ì´í„°ë² ì´ìŠ¤ì™€ ì§ì ‘ì ìœ¼ë¡œ ìƒí˜¸ì‘ìš©í•˜ëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë°œìƒí•œë‹¤. 
(ì¶œì²˜: chatGPT)

### ì˜ˆì‹œ) 
1. ì œëª©: aaa
2. ë‚´ìš©: bbb'), ('ccc','ccc'), ('ddd','ddd

SQLë¬¸: insert into x_board(title, contents) values('%s', '%s')


### ìµœì¢…ì ìœ¼ë¡œ ìƒì„±ëœ SQL? 
=> insert into x_board(title, contents) values ('aaa', 'bbb'), ('ccc', 'ccc'), ('ddd', 'ddd')â€‹

ì‚¬ìš©ìê°€ ì…ë ¥í•œ ê°’ì„ ê°€ì§€ê³  SQLë¬¸ì„ ë§Œë“¤ë©´ SQLë¬¸ì´ ì™œê³¡ë  ìˆ˜ ìˆë‹¤. 
ì´ëŸ° ì‹ì˜ í•´í‚¹ ê¸°ë²•ì„ "SQL ì‚½ì… ê³µê²©"ì´ë¼ê³  ë¶€ë¥¸ë‹¤. 

### ë°©ì§€ì±…: "PreparedStatement"ë¥¼ ì‚¬ìš©í•œë‹¤. 
ì• ì´ˆë¶€í„° ë¶„ë¦¬í•´ì„œ ë³´ë‚´ëŠ” ê²ƒì´ë‹¤.

PreparedStatementë¥¼ ì‚¬ìš©í•˜ì—¬ mysql í´ë”ì— ìˆë˜ DAOImplê°€ ë°›ì„ ìˆ˜ ìˆëŠ” SQL ì‚½ì… ê³µê²©ì„ ë§‰ì•„ë³´ê² ë‹¤.
ê¸°ì¡´ì— Statement stmt = ìœ¼ë¡œ ë˜ì–´ìˆë˜ ë¶€ë¶„ì„ ì¼ê´„ìˆ˜ì •(MacOs: cmd + shift + f / Windows: ctrl + shift + r)ë¡œ PreparedStatement stmtë¡œ ë°”ê¿”ì¤€ë‹¤. 

#### ë°©ë²•: 
ìš°ì„ , PreparedStatementë¥¼ ì„í¬íŠ¸í•´ì¤€ë‹¤. 

```java
import java.sql.PreparedStatement;
```

ê·¸ëŸ¬ë©´ AssignmentDaoImplë¼ëŠ” ê³¼ì œ íŒŒì¼ì„ ì˜ˆì‹œë¡œ CRUDì— ì–´ë–»ê²Œ ì ìš©í•´ì•¼í• ì§€ ì•Œì•„ë³´ê² ë‹¤. 

=> preparedStatementë¥¼ ì ìš©í•˜ê¸° ì „ ì½”ë“œ:

```java
public class AssignmentDaoImpl implements AssignmentDao {

  Connection con;

  public AssignmentDaoImpl(Connection con) {
    this.con = con;
  }

  @Override
  public void add(Assignment assignment) {
    try {
      Statement stmt = con.createStatement();
      stmt.executeUpdate(String.format(
          "insert into assignments(title,content,deadline) values('%s','%s','%s')",
          assignment.getTitle(), assignment.getContent(), assignment.getDeadline()));

    } catch (Exception e) {
      throw new DaoException("ë°ì´í„° ì…ë ¥ ì˜¤ë¥˜", e);
    }
  }

  @Override
  public int delete(int no) {
    try {
      Statement stmt = con.createStatement();
      return stmt.executeUpdate(
          String.format("delete from assignments where assignment_no=%d", no));

    } catch (Exception e) {
      throw new DaoException("ë°ì´í„° ì‚­ì œ ì˜¤ë¥˜", e);
    }
  }

  @Override
  public List<Assignment> findAll() {
    try {
      Statement stmt = con.createStatement();
      ResultSet rs = stmt.executeQuery("select * from assignments");

      ArrayList<Assignment> list = new ArrayList<>();

      while (rs.next()) {
        Assignment assignment = new Assignment();
        assignment.setNo(rs.getInt("assignment_no"));
        assignment.setTitle(rs.getString("title"));
        assignment.setContent(rs.getString("content"));
        assignment.setDeadline(rs.getDate("deadline"));

        list.add(assignment);
      }
      return list;

    } catch (Exception e) {
      throw new DaoException("ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜", e);
    }
  }

  @Override
  public Assignment findBy(int no) {
    try {
      Statement stmt = con.createStatement();
      ResultSet rs = stmt.executeQuery("select * from assignments where assignment_no=" + no);

      ArrayList<Assignment> list = new ArrayList<>();

      if (rs.next()) {
        Assignment assignment = new Assignment();
        assignment.setNo(rs.getInt("assignment_no"));
        assignment.setTitle(rs.getString("title"));
        assignment.setContent(rs.getString("content"));
        assignment.setDeadline(rs.getDate("deadline"));

        return assignment;
      }
      return null;

    } catch (Exception e) {
      throw new DaoException("ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜", e);
    }
  }

  @Override
  public int update(Assignment assignment) {
    try {
      Statement stmt = con.createStatement();
      return stmt.executeUpdate(String.format(
          "update assignments set title='%s', content='%s', deadline='%s' where assignment_no=%d",
          assignment.getTitle(), assignment.getContent(), assignment.getDeadline(),
          assignment.getNo()));

    } catch (Exception e) {
      throw new DaoException("ë°ì´í„° ë³€ê²½ ì˜¤ë¥˜", e);
    }
  }
}
```

- ì°¸ê³ : CRUD & SQL ë¬¸ë²•
  - Create = insert
  - Retrive(Read) = select
  - Update = update
  - Delete = delete

(1) Add
```java
  @Override
  public void add(Assignment assignment) {
    try (PreparedStatement pstmt = con.prepareStatement(
          "insert into assignments(title,content,deadline) values(?,?,?)")) {
        pstmt.setString(1, assignment.getTitle());
        pstmt.setString(2, assignment.getContent());
        pstmt.setDate(3, assignment.getDeadline());

        pstmt.executeUpdate();

    } catch (Exception e) {
      throw new DaoException("ë°ì´í„° ì…ë ¥ ì˜¤ë¥˜", e);
    }
  }
```

(2) Delete
```java
@Override
  public int delete(int no) {
    try (PreparedStatement pstmt = con.prepareStatement(
        "delete from assignments where assignment_no=?")) {
      pstmt.setInt(1, no);
        return pstmt.executeUpdate();

    } catch (Exception e) {
      throw new DaoException("ë°ì´í„° ì‚­ì œ ì˜¤ë¥˜", e);
    }
  }
```

(3) FindAll
```java
  @Override
  public List<Assignment> findAll() {
    try (PreparedStatement pstmt = con.prepareStatement(
        "select assignment_no, title, deadline from assignments order by assignment_no desc");
        ResultSet rs = pstmt.executeQuery()) {

      ArrayList<Assignment> list = new ArrayList<>();

      while (rs.next()) {
        Assignment assignment = new Assignment();
        assignment.setNo(rs.getInt("assignment_no"));
        assignment.setTitle(rs.getString("title"));
        assignment.setDeadline(rs.getDate("deadline"));

        list.add(assignment);
      }
      return list;

    } catch (Exception e) {
      throw new DaoException("ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜", e);
    }
  }
```

(4) FindBy
```java
@Override
  public Assignment findBy(int no) {
    try (PreparedStatement pstmt = con.prepareStatement(
        "select * from assignments where assignment_no=?")){

      pstmt.setInt(1, no);

      try(ResultSet rs = pstmt.executeQuery()) {

        if (rs.next()) {
          Assignment assignment = new Assignment();
          assignment.setNo(rs.getInt("assignment_no"));
          assignment.setTitle(rs.getString("title"));
          assignment.setContent(rs.getString("content"));
          assignment.setDeadline(rs.getDate("deadline"));
          return assignment;
        }
        return null;
      }

    } catch (Exception e) {
      throw new DaoException("ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜", e);
    }
  }
```

(4) Update
```java
@Override
  public int update(Assignment assignment) {
    try (PreparedStatement pstmt = con.prepareStatement(
          "update assignments set title=?, content=?, deadline=? where assignment_no=?")) {
      pstmt.setString(1, assignment.getTitle());
      pstmt.setString(2, assignment.getContent());
      pstmt.setDate(3, assignment.getDeadline());
      pstmt.setInt(4, assignment.getNo());
      return pstmt.executeUpdate();

    } catch (Exception e) {
      throw new DaoException("ë°ì´í„° ë³€ê²½ ì˜¤ë¥˜", e);
    }
  }
```


ğŸš¨ ì£¼ì˜: '?' ë¬¼ìŒí‘œë¥¼ ì‹±ê¸€ ì¿¼í…Œì´ì…˜ ì•ˆì— ë„£ìœ¼ë©´ ì¼ë°˜ ë¬¸ìì—´ë¡œ ë¬¼ìŒí‘œë¥¼ ì¸ì‹í•˜ê²Œ ëœë‹¤. 